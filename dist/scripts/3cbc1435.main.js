!function(){var a=function(a,b){return function(c,d){var e,f;e=[],f=new RegExp(c,"i");var e=a.filter(function(a){return f.test(a[b])});1==e.length&&app.drawResults(e[0]),d(e.slice(0,10))}};app.initTypeahead=function(){$("#job").typeahead({minLength:1,highlight:!0},{name:"name",displayKey:"name",source:a(app.data,"name")}).on("typeahead:selected",function(a,b){app.drawResults(b)})}}(),function(){app.init=function(){d3.tsv(app.dataPath,function(a){return{id:a.id,name:a.title,rank:+a.rank,probability:+a.probability.replace(",",".")}},function(a,b){app.data=b,$(app).trigger("app:dataReady")})}}(),$(app).on("app:dataReady",function(){app.initTypeahead(),app.chart=new ProbChart("#chart-main",function(){return"A long sentance"}),app.histogramAll=new Histogram("#histogram-all",app.data)}),Histogram=function(){function a(a,b){var c=this,d=.02;c.baseColor="#999",c.fillColor=app.themeColor,c.container=d3.select(a);var e=400;c.elem=c.container.append("div").attr("class","chart histogram"),c.margin=m={top:0,bottom:0,right:.1*e,left:.1*e},c.width=w=e-m.left-m.right,c.height=h=.6*w,c.svg=c.elem.append("svg").attr("width",w+m.left+m.right).attr("height",h+m.top+m.bottom),c.chart=c.svg.append("g").attr("transform","translate("+m.left+","+m.top+")"),c.values=b.map(function(a){return a.probability}),c.data=d3.layout.histogram().bins(1/d)(c.values),c.x=d3.scale.linear().domain([0,1]).range([0,w]),c.y=d3.scale.linear().domain([0,d3.max(c.data,function(a){return a.y})]).range([h,0]),c.barGroups=c.chart.selectAll(".bar").data(c.data).enter().append("g").attr("class","bar").attr("transform",function(a){return"translate("+c.x(a.x)+","+c.y(a.y)+")"}),c.bars=c.barGroups.append("rect").attr("x",1).attr("fill",app.baseColor).attr("width",c.x(c.data[0].dx)-1).attr("height",function(a){return h-c.y(a.y)})}return a.prototype.addReference=function(a){var b=this;b.bars.transition().attr("fill",function(b){return b[b.length-1]>a?app.themeColor:app.baseColor}).duration(500).delay(function(a,b){return 20*b})},a.prototype.clear=function(){self.bars.transition()},a}(),ProbChart=function(){function a(a,b){var e=this;e.baseColor="#666",e.color=d3.scale.linear().domain([0,.5,1]).range(["green","red"]),e.container=d3.select(a);var f=400;e.elem=e.container.append("div").attr("class","chart prob-chart"),e.margin=m={top:.06*f,bottom:.08*f,right:0,left:0},e.width=w=f-m.left-m.right,e.height=h=.6*w,e.radius=r=(h-(m.top-m.bottom))/2,e.percent=0,e.longSentence=b,e.getShortSentence=d,e.svg=e.elem.append("svg").attr("width",w+m.left+m.right).attr("height",h+m.top+m.bottom),e.chart=e.svg.append("g").attr("transform","translate("+(w/2+m.left)+","+(h/2+m.top)+")"),e.arc=d3.svg.arc().innerRadius(.8*r).outerRadius(r).startAngle(0),e.leftArc=e.chart.append("path").datum({endAngle:c}).style("fill",e.baseColor).attr("d",e.arc),e.rightArc=e.chart.append("path").datum({endAngle:e.percent*c}).attr("fill",e.color(e.percent)).attr("d",e.arc);var g=10+.05*w;e.label=e.svg.append("text").attr("class","value").attr("dy",".7em").attr("font-size",1.5*g+"px").attr("text-anchor","middle").attr("transform","translate("+[w/2,h/2]+")"),e.answer=e.elem.append("div").attr("class","answer"),e.answer.append("div").attr("class","short-answer").text(),e.answer.append("div").attr("class","long-answer").text()}function b(a,b,e){a.attrTween("d",function(a){var f=d3.interpolate(a.endAngle,b*c);return function(c){var g=e.percent+(b-e.percent)*c;return e.label.text(function(){return d(g)}),e.rightArc.attr("fill",e.color(g)),a.endAngle=f(c),e.arc(a)}})}var c=2*Math.PI,d=function(a){var b;return.2>a?b="Nej":a>=.2&&.4>a?b="Knappast":a>=.4&&.6>a?b="Oklart":a>=.6&&.8>a?b="Troligen":a>=.8&&(b="Ja"),b};return a.prototype.update=function(a,c,d){var e=this;e.rightArc.transition().duration(800).call(b,a,e).each("end",function(){if(e.percent=a,d)for(var b=0;b<d.length;b++)d[b]()})},a.prototype.destroy=function(){var a=this;return a.el.remove(),a},a}(),function(){function a(a){var b=app.data.filter(function(b){return b.probability>a}).length,c=app.data.length;return b+" av "+c+" jobb är mer utsatta."}var b=$("#results"),c=b.find("#probability .value"),d=$("#histogram-sentence");app.drawResults=function(e){b.removeClass("hidden"),c.text(app.utils.formatPercent(e.probability)),app.chart.update(e.probability),app.histogramAll.addReference(e.probability,e.name),d.html(a(e.probability))}}(),app.themeColor="#328032",app.baseColor="#999",function(){app.utils={};var a=d3.locale({decimal:",",thousands:" ",grouping:[3],currency:[""," kr"],dateTime:"%A %e %B %Y kl. %X",date:"%d.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["måndag","tisdag","onsdag","torsdag","fredag","lördag","söndag"],shortDays:["må","ti","ons","to","fre","lö","sö"],months:["januari","februari","mars","april","maj","juni","juli","augusti","september","oktober","november","december"],shortMonths:["jan","feb","mars","apr","maj","jun","jul","aug","sept","okt","nov","dec"]});app.utils.formatPercent=a.numberFormat("%")}();